# å›¾ç‰‡æ ‡æ³¨ç»„ä»¶ï¼ˆimage-annotationï¼‰

åŸºäº React + TypeScript çš„ Web å›¾ç‰‡æ ‡æ³¨ç»„ä»¶ï¼Œæ”¯æŒçŸ©å½¢ã€åœ†ã€ç®­å¤´ã€æ–‡å­—ã€è‡ªç”±ç”»ç¬”ç­‰å·¥å…·ï¼Œæä¾›æ’¤é”€/é‡åšã€æ‹–æ‹½ã€å¯¼å‡ºã€å¿«æ·é”®ç­‰èƒ½åŠ›ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- **å¤šç§æ ‡æ³¨ç±»å‹**ï¼šçŸ©å½¢ã€åœ†å½¢ã€ç®­å¤´ã€æ–‡å­—ã€è‡ªç”±ç”»ç¬”
- **æ ·å¼è‡ªå®šä¹‰**ï¼šå¯è°ƒæ•´æ ‡æ³¨é¢œè‰²å’Œçº¿å®½
- **äº¤äº’æ“ä½œ**ï¼šæ”¯æŒæ‹–æ‹½ç§»åŠ¨ã€æ’¤é”€æ“ä½œã€åˆ é™¤æ ‡æ³¨
- **æ•°æ®å¯¼å‡º**ï¼šå¯å¯¼å‡ºæ ‡æ³¨åçš„å›¾ç‰‡ä»¥åŠæ ‡æ³¨æ•°æ®
- **æŠ—æ¨¡ç³Šç»˜åˆ¶**ï¼šåŸºäº DPR çš„æ¸…æ™°ç»˜åˆ¶ï¼Œé¿å…é«˜æ¸…å±æ¨¡ç³Š
- **ç­‰æ¯”å±…ä¸­**ï¼šå›¾ç‰‡åœ¨ canvas ä¸­æŒ‰åŸå§‹æ¯”ä¾‹å±…ä¸­æ˜¾ç¤º
- **å¿«æ·é”®æ”¯æŒ**ï¼šæ”¯æŒé”®ç›˜å¿«æ·é”®æ“ä½œ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pnpm install
```

### å¼€å‘æ¨¡å¼

```bash
pnpm dev
```

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:3000 æŸ¥çœ‹åº”ç”¨ã€‚

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
pnpm run build
```

æ„å»ºåçš„æ–‡ä»¶å°†ç”Ÿæˆåœ¨ `build` ç›®å½•ä¸­ã€‚

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨ï¼ˆä½œä¸ºä¾èµ–åŒ…ï¼‰

```jsx
import { useState } from 'react';
import { ImageAnnotation, type Annotation } from '@frank17008/image-annotation';
import '@frank17008/image-annotation/dist/index.css';

export default function App() {
  const [annotations, setAnnotations] = useState<Annotation[]>([]);
  return (
    <div style={{ height: 600 }}>
      <ImageAnnotation
        src="https://example.com/image.jpg"
        onChange={setAnnotations}
      />
    </div>
  );
}
```

è¯´æ˜ï¼š

- ç»„ä»¶ä¼šè®© canvas å……æ»¡çˆ¶å®¹å™¨ï¼ˆå³å¤–å±‚å®¹å™¨éœ€æœ‰æ˜ç¡®é«˜åº¦æˆ–å¯è®¡ç®—çš„é«˜åº¦ï¼‰ã€‚
- å›¾ç‰‡ä¼šåœ¨ canvas å†…æŒ‰åŸå§‹å®½é«˜æ¯”å±…ä¸­æ˜¾ç¤ºï¼›DPR è‡ªé€‚é…é¿å…æ¨¡ç³Šã€‚

### æœ¬ä»“åº“å†…æœ¬åœ°ç¤ºä¾‹

ä»“åº“è‡ªå¸¦ç¤ºä¾‹åº”ç”¨ï¼ˆ`/src`ï¼‰ï¼Œè¿è¡Œæ–¹å¼è§â€œå¼€å‘æ¨¡å¼â€ã€‚

### å·¥å…·æ åŠŸèƒ½

1. **é¢œè‰²é€‰æ‹©å™¨**ï¼šé€‰æ‹©æ ‡æ³¨çº¿æ¡çš„é¢œè‰²
2. **çº¿å®½è°ƒæ•´**ï¼šè°ƒæ•´æ ‡æ³¨çº¿æ¡çš„ç²—ç»†ï¼ˆ1-10pxï¼‰
3. **å·¥å…·é€‰æ‹©**ï¼š
   - çŸ©å½¢å·¥å…·ï¼šç»˜åˆ¶çŸ©å½¢æ ‡æ³¨
   - åœ†å½¢å·¥å…·ï¼šç»˜åˆ¶åœ†å½¢æ ‡æ³¨
   - ç®­å¤´å·¥å…·ï¼šç»˜åˆ¶ç®­å¤´æ ‡æ³¨
   - æ–‡å­—å·¥å…·ï¼šæ·»åŠ æ–‡å­—æ ‡æ³¨
   - è‡ªç”±çº¿æ¡ï¼šè‡ªç”±ç»˜åˆ¶ä»»æ„å½¢çŠ¶
4. **æ“ä½œæŒ‰é’®**ï¼š
   - æ¸…é™¤æ‰€æœ‰ï¼šæ¸…ç©ºç”»å¸ƒä¸Šçš„æ‰€æœ‰æ ‡æ³¨
   - ä¸Šä¸€æ­¥ï¼šæ’¤é”€ä¸Šä¸€æ¬¡æ“ä½œï¼ˆæ”¯æŒ Ctrl+Z å¿«æ·é”®ï¼‰
   - å¯¼å‡ºï¼šå°†æ ‡æ³¨åçš„å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°

### å¿«æ·é”®æ“ä½œ

- **Delete**ï¼šåˆ é™¤é€‰ä¸­çš„æ ‡æ³¨
- **Ctrl+Z**ï¼šæ’¤é”€ä¸Šä¸€æ­¥æ“ä½œ
- **Ctrl+Y**ï¼šé‡åš
- **Escape**ï¼šå–æ¶ˆæ–‡å­—è¾“å…¥çŠ¶æ€

## ğŸ§© ç»„ä»¶ API

### ImageAnnotation

Propsï¼š

- `src: string`ï¼ˆå¿…å¡«ï¼‰å›¾ç‰‡åœ°å€
- `onChange?: (annotations: Annotation[]) => void` æ ‡æ³¨å˜åŒ–å›è°ƒ

è¡Œä¸ºï¼š

- ç”»å¸ƒå°ºå¯¸ç”±çˆ¶å®¹å™¨å†³å®šï¼ˆç»„ä»¶å†…éƒ¨ä½¿ canvas å¡«æ»¡çˆ¶å®¹å™¨ï¼‰ã€‚
- å›¾ç‰‡ä¼šåœ¨å½“å‰ canvas å°ºå¯¸å†…æŒ‰æ¯”ä¾‹ç¼©æ”¾å¹¶å±…ä¸­æ˜¾ç¤ºã€‚
- ç»„ä»¶å¯¹é«˜æ¸…å±è¿›è¡Œ DPR å¤„ç†ï¼Œä¿è¯ç»˜åˆ¶æ¸…æ™°ã€‚

### Annotationï¼ˆæ ‡æ³¨æ•°æ®ç»“æ„ï¼‰

æ ¸å¿ƒå­—æ®µï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š

- å…¬å…±ï¼š`id?: string`, `color: string`, `lineWidth?: number`
- çŸ©å½¢ï¼š`{ type: 'rectangle', x, y, width, height }`
- åœ†ï¼š`{ type: 'circle', x, y, radius }`
- ç®­å¤´ï¼š`{ type: 'arrow', x, y, width, height }`ï¼ˆèµ·ç‚¹ä¸º `x,y`ï¼Œç»ˆç‚¹ä¸º `x+width,y+height`ï¼‰
- æ–‡å­—ï¼š`{ type: 'text', x, y, text }`
- è‡ªç”±ç”»ç¬”ï¼š`{ type: 'freehand', points: {x,y}[] }`

> å®Œæ•´ç±»å‹å®šä¹‰è§ `packages/image-annotation/src/types/annotations.ts`ã€‚

## ğŸ§± å¸ƒå±€ä¸æ¸…æ™°åº¦å»ºè®®

- å¤–å±‚å®¹å™¨éœ€æœ‰æ˜ç¡®é«˜åº¦ï¼ˆä¾‹å¦‚å›ºå®šé«˜ã€ç™¾åˆ†æ¯”é«˜å¹¶ç¡®ä¿ç¥–å…ˆå¯è®¡ç®—ï¼‰ã€‚
- `ImageAnnotation` ä¼šè®© `canvas` å¡«æ»¡çˆ¶å®¹å™¨ã€‚
- ç»„ä»¶å†…éƒ¨åœ¨æ¯æ¬¡ç»˜åˆ¶å‰åŒæ­¥ canvas å°ºå¯¸å¹¶è¿›è¡Œ DPR é€‚é…ï¼Œé¿å…æ¨¡ç³Šã€‚

## ğŸ“¦ æ‰“åŒ… & å‘å¸ƒ

åŒ…å…¥å£åœ¨ `packages/image-annotation`ï¼Œæ„å»ºäº§ç‰©ä½äºå…¶ `dist/`ã€‚

å¸¸ç”¨å‘½ä»¤ï¼š

```bash
pnpm -w build                      # æ„å»ºæ‰€æœ‰åŒ…
pnpm -w --filter image-annotation build  # ä»…æ„å»ºç»„ä»¶åŒ…
```

## ğŸ›  æŠ€æœ¯æ ˆ

- React 18 + TypeScript
- Canvas 2D
- pnpm / tsup
